pipeline {
  agent any
   
  parameters {
    booleanParam(name: 'autoApprove', defaultValue: false, description: 'Automatically run apply after generating plan?') 
  }
  
  environment {
        AWS_ACCESS_KEY_ID     = credentials('AWS_ACCESS_KEY_ID')
        AWS_SECRET_ACCESS_KEY = credentials('AWS_SECRET_ACCESS_KEY')
        TF_IN_AUTOMATION      = '1'
  }

  stages {
    
    stage('Checkout') {
        steps {
            git branch: 'master',
                credentialsId: 'my_cred_id',
                url: 'https://github.com/99harshil/AWS-Terraform-infrastructure.git'

            sh "ls"
        }
    }

    stage('init') {
      steps {
        dir('terraform/backend') {
          withAWS(credentials: '493d0f87-10d7-4be2-9108-f18321145beb', region: 'us-east-1') {
             terraform init
          }
        }
      }
    }
  }
}
